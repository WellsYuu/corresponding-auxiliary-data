package com.jiagouedu.services.manage.activity;import com.jiagouedu.core.ServersManager;import com.jiagouedu.services.manage.activity.bean.Activity;import com.jiagouedu.services.manage.activity.dao.ActivityDao;import com.jiagouedu.services.manage.product.ProductService;import com.jiagouedu.services.manage.product.bean.Product;import org.apache.commons.lang.StringUtils;import org.springframework.stereotype.Service;import javax.annotation.Resource;import java.util.LinkedList;import java.util.List;@Service("activityServiceManage")public class ActivityServiceImpl extends ServersManager<Activity, ActivityDao> implements        ActivityService {    @Resource(name = "activityDaoManage")    @Override    public void setDao(ActivityDao activityDao) {        this.dao = activityDao;    }    @Resource(name = "productServiceManage")	private ProductService productService;		public ProductService getProductService() {		return productService;	}	public void setProductService(ProductService productService) {		this.productService = productService;	}	/**	 * 新增活动	 */	@Override	public int insert(Activity e) {		if(StringUtils.isBlank(e.getProductID())){			throw new NullPointerException("参与活动的商品ID不能为空！");		}				int activityID = super.insert(e);				e.setId(String.valueOf(activityID));				updateProductBindActivityId(e);				return activityID;	}	/**	 * 修改活动	 */	@Override	public int update(Activity e) {		if(StringUtils.isBlank(e.getProductID())){			throw new NullPointerException("参与活动的商品ID不能为空！");		}		//将此活动原来绑定的商品去除，重新绑定一个商品		productService.updateResetThisProductActivityID(e.getId());		updateProductBindActivityId(e);				return super.update(e);	}		private void updateProductBindActivityId(Activity e) {		Product pro = new Product();		pro.setActivityID(e.getId());		if(pro.getProductIds()==null){			pro.setProductIds(new LinkedList<String>());		}				String[] productIDArr = e.getProductID().split("\\|");		for(int i=0;i<productIDArr.length;i++){			pro.getProductIds().add(productIDArr[i].trim());		}		productService.updateProductBindActivityId(pro);	}	public List<Activity> selectList(Activity activity) {		List<Activity> all=dao.selectList(activity);		return all;	}}